---
title: "p8105_hw5_sp4170"
author: "Shihui Peng"
date: "2023-11-15"
output: github_document
---
load package and set seed for reproducibility
```{r, echo=FALSE, message=FALSE}
library(tidyverse)
set.seed(1)
```


# problem 2

## data import

```{r}
file_import_df = 
  tibble(
    file_name = list.files(path = 'data/'),
    path = str_c('data/', file_name)
  ) |> 
  mutate(
    data = map(path, read_csv)
  ) |> 
  unnest(data)
```
* i create a df named 'file_import_df', make a tibble consisted of every file's name and their relative path. i use `mutate()` to create a new variable 'data', which contain every csv file i imported using `map()` function. I use `unnest()` to unnest contents of each cell of variable data.

## data tidy

```{r}
file_tidy_df = 
  file_import_df |> 
  janitor::clean_names() |> 
  separate(file_name, c('arm', 'subject_id'), sep = '\\_') |> 
  select(-path) |> 
  mutate(
    subject_id = str_remove(subject_id, '\\.csv'),
    arm = ifelse(arm == 'con', 'control', 'experiment')
  ) |> 
  pivot_longer(
    week_1 : week_8,
    names_to = 'observation_time',
    values_to = 'value',
    names_prefix = 'week_'
  ) |> 
  mutate(
    observation_time = as.numeric(observation_time)
  )
```
* i tidy the result:
  * i use `separate()` to create variable 'arm' and 'subject_id'. i remove column 'path' as it is not needed. i mutate variable subject_id by deleting the suffix and variable arm by renaming 'con' as 'control' and 'exp' as 'experience'. I tidy cols week_1 to week_8 and create col 'observation_time' indicating weeks for each observation time point and col 'value' for each value. i change the data type of variable observation_time from character type to numeric type.

## make a plot

```{r}
file_tidy_df |> 
  ggplot(aes(x = observation_time, y = value, color = subject_id, alpha = 0.5)) +
  geom_line() +
  facet_grid(. ~ arm)
```

* i make a spaghetti plot
* comment
  * the values of subjects in experiment arm suppress the values of subjects in control arm in the last observation time. in the baseline (the first observation time), both arms had similar value, while the spread of baseline value in experiment arm was larger than the spread in the control arm
  * the values of subjects in control arm across observation time did not change appreciably. but the values of subjects in experiment arm across observation time had an increase trend in general.
